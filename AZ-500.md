# AZ-500

![Screenshot 2023-04-28 at 20.27.53.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/DDFB3C2F-133D-44F0-BE58-DFEBCAE63CA8_2/YxXDX68WVr7BZMMiMaQQyLhltN5yJAKHzEAFpHqyDwYz/Screenshot%202023-04-28%20at%2020.27.53.jpeg)

> # Controlling Access

### Azure AD

![Screenshot 2023-05-02 at 20.45.41.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/90D3097D-B506-4AF4-AF68-7614321D36BA_2/XNVe48rJGupNrNI7WLZtsLpsx8YHCmyDfE326ZAE2ZAz/Screenshot%202023-05-02%20at%2020.45.41.jpeg)

### Azure (Tenant)

![Screenshot 2023-05-02 at 20.47.17.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/1E4480DA-D15F-4DA4-84F2-2912B4E19D42_2/Qnd17iklP63Y22Ey49ZV3g0QOu6TJ0l9N3kxySTyl4Az/Screenshot%202023-05-02%20at%2020.47.17.jpeg)

Users will tend to have specific permissions to access / modify certain features within the subscription.

> ## Hybrid Identity With Azure AD Connect

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/181FF781-16CF-40E3-9273-5CADD2B4F2A7_2/aWsNhHhLLFauL3oxsvQycgpypBAH71peNoFAKPQgnn8z/Image.jpeg)

> # Azure RBAC - Protecting your Azure resources

![Screenshot 2023-05-02 at 20.52.16.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/541138C2-F9BB-4A7C-A1E1-1613F27CED30_2/hhnARYv6b8JzINzHmiyxhHkWvYlSfHBezLUMxgywQY4z/Screenshot%202023-05-02%20at%2020.52.16.jpeg)

![Screenshot 2023-05-02 at 20.51.44.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/F4631DD9-C68E-46E3-AAC0-C0F5795D9DFC_2/UvIUb8UFji0kqQHt7yu7ypiQwZMqdIz0pb27M5AIylwz/Screenshot%202023-05-02%20at%2020.51.44.jpeg)

![Screenshot 2023-05-02 at 20.51.30.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/4E273670-FCB3-4674-BE30-47E6B6E8F733_2/GchV5LMLaA18z5gyhWcy0xoczTEh22yJ8XSxWVyrWh0z/Screenshot%202023-05-02%20at%2020.51.30.jpeg)

### Example of Access Requirements (Least Privilege)

![Screenshot 2023-05-02 at 20.58.16.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/9C352B35-B233-4D16-BBAA-1C4A6297BA22_2/14rAlsDR6obyfsGTGLnmjyvJDKNIbqBTxkwsxtp17TIz/Screenshot%202023-05-02%20at%2020.58.16.jpeg)

Contributor - Gives full access to a given thing except the power of changing permissions.

> ## Key Points

![Screenshot 2023-05-02 at 21.08.22.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/0ED46A84-6499-4EA4-A092-A98A96728674_2/xCHvAskx0mHvg8DM2z0MC52tvX6Ji7m7Jzx8Lx0gmvMz/Screenshot%202023-05-02%20at%2021.08.22.jpeg)

> ## Azure AD Roles

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/28A7197C-7450-46FD-989E-9E7041A6A466_2/OaweqrHTKbtHQwtNEhEtifNFJBtWprgbzjtz78RCB5Mz/Image.jpeg)

> ## Key Points

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/A6208FA6-F43C-4520-B6AA-798E60DE9863_2/Gfy1uEKNKEFQx732tpCxWyDc1ypLD76u7CsomqZg6u0z/Image.jpeg)

> ## Securing Identities and Access

### PIM

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/0339AAB0-D1CC-4483-AE2D-6CBD517A7A1E_2/dAsR4mM60LtmS0lFwuy7uoZbzgeNdfpYHoNfuCa3B8gz/Image.jpeg)

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/D80D8AA6-F0C2-497C-94B3-3E1FE78BA695_2/9YtOUCJ8CS9HzVfvfIDLRFdL9xr7q8zMJ6RGEREAnhEz/Image.jpeg)

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/001F0B98-BC4F-4833-ACDF-FCE2138CFF40_2/yD7tUJJtRlaChUY5FtSfKyREjpTEBL7nyY2iVWyzWuUz/Image.jpeg)

> ### Azure AD Identity Protection

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/E9E2D4F3-94EA-4664-B413-B7AA410B4F76_2/sSiqXlHkSOqlrx9tMfUMmz8CDJbFkxlO8BZf84uFLHgz/Image.jpeg)

> ## Important Considerations

![Screenshot 2023-05-22 at 19.41.29.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/A1A91E6F-2A75-4D71-8087-0188A1366C69_2/DlySWkytk3EHEKeWQbNxwxFrg4xANEZ9QnmC0CD6U4Az/Screenshot%202023-05-22%20at%2019.41.29.jpeg)

> ## Conditional Access

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/C946B089-DA6A-46F6-AC82-77DAAC1803F2_2/UBcDFPmuKvkRIo7hFFkx3bbA3P5MjDjxP8RJNYDsD6Az/Image.jpeg)

> ## Passwordless Authentication

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/F2C37B6C-8DAD-4F19-B94F-93C2E884D09C_2/1dTB5xmFQPdZMk84tlhsieVYgNVrUcBdq2MuxsTXCYUz/Image.jpeg)

> ## Securing Virtual Networks

![Screenshot 2023-06-12 at 20.23.41.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/DA0DFDA5-86C0-4C1C-A60A-6195460AA166_2/yl9MQ24yaK8IECa2T5MNuM5ocBBaNFj7LeSd6g5yc7wz/Screenshot%202023-06-12%20at%2020.23.41.jpeg)

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/7BB14033-B1CD-4AC8-94A2-CEBDB5FCEC18_2/38J18TxcpCGzbhMmeoj6dWNINh4ejld4TLgLd7nxfmMz/Image.jpeg)

> ## Network Security Group (NSG)

- > Filter Traffic - Create rules to define what is and is not allowed
- > Multi-Layered - Enforce traffic filtering at the subnet and NIC layers
- > Prioritised Rules - Leverage priorities to define complex security rules
- > 2 DenyALLInbound and outbound rules auto configured when an NSG is created. All traffic is blocked as default until you create an ALLOW rule.
- > You must define priorities for rules, the lower the number the higher the priority.
- > You can assign an NSG directly to a NIC or a Subnet. If you assign an NSG to a Subnet, it will affect all resources within that subnet.
- > Basic SKU public IP address allows all inbound traffic.
- > Standard SKU denies all inbound traffic so when setting up an NSG, you will be setting up Allow rules.

> ### Important Considerations

- > Differences with Public IPs - Without an NSG, all traffic is allowed by default if your resource has a public IP address. This is not the case for Standard SKU public IPs.
- > Rules are Stateful - NSGs are stateful, which means that they reply traffic is allowed automatically if the sending traffic has been allowed.
- > Best practice - It is considered best practice to block ALL traffic, except that which is required. This is commonly referred to as "default deny".

> ## Augmented Security Rules

### Service Tags

- > They are a collection of IP address prefixes that correspond to a specific Azure Service.
- > Microsoft manages the associated IP addresses of service tags, as Azure services can regularly change.
- > Service tags can be used within both network security groups and Azure firewall.

### Application Security Groups

- > ASGs are logical containers for the network interfaces used in your solution.
- > An ASG can be used easily within NSG rules to simplify the management of security rules for a solution.
- > All network interface cards for an ASG must exist in the same VNet. This is also true when an ASG is used in a rule for both source and destination.

> # Azure Firewall

- > Firewall capabilities more akin to an on-prem firewall.
- > Includes additional capabilities compared to NSGs
- > Fully managed including high availability and scale.

### Key Features

- > Firewall as a Service - Stateful, fully managed with high availability and unrestricted cloud scalability.
- > Supports FQDN filtering
- > Network Filtering - Standard firewall rules, supporting source, protocols, destination etc
- > DNAT and SNAT - Configure inbound DNAT and outbound SNAT network address translation rules.
- > Threat Intelligence - Additional functionality to identify malicious IP addresses and domains.
- > Monitoring - Integration with Azure Monitor logging (archive, streaming, and Log Analytics).

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/9BA82F08-7096-4BE5-8DBC-CB0FC3621D32_2/BNoIqyKkiDkjPbracMsEQfUFJVgBrM8YAF6x9yxQi3Mz/Image.jpeg)

> ## Azure Firewall Manager

### Deployment Architectures

- Hub Virtual Network
- Secure Virtual Hubs

### Virtual Secure Networks and Virtual Secure Hubs

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/5D84F592-66C9-467D-A1DB-11DD03EDD473_2/I2wEPcI8mu8Z72OxCfZCwNFT8RdAF3tn9I6q3ScpqhYz/Image.jpeg)

> # DDoS Protection

> ### Protect VNet Resources

- > Protect resources in your virtual networks across subscriptions.

> ### Simplified Deployment

- > Enabled by default. Additional features are easy to deploy.

> ### Included and Paid Options

- > Default protection is included, but additional features are available for a fee.

> ## Key Features

> ### Turnkey Protection

- > Associate DDoS Protection with your virtual networks for simplified protection.

> ### Adaptive Tuning

- > Intelligently identify real traffic associated with your applications.

> ### Cost Guarantee

- > Data transfer and application scale out costs will be credited if a DDoS attack occurs.

> ### Native integration

- > Native integration with the Azure platform. Traffic doesn't need to leave Azure.

> ### Detailed Analytics

- > Monitoring, alerts, and integration with services like Azure Sentinel and Security Centre.

> ### Rapid Response

- > Engage the DDoS Protection Rapid Response (DRR) team for assistance with attacks.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/850E693C-0398-479D-B36D-7585CCE55A6D_2/wjYQb5uRmvLZbvYqwByrE2YeuzGVnHNxNEapDvtrCzQz/Image.jpeg)

> # Securing Integrated Networks and Services

## Service Endpoints

- > Private Access
   - > Provide access to Azure services from within your private virtual network.
- > Backbone Routing
   - > Traffic between configured services uses the Microsoft backbone.
- > Secure with Firewalls
   - > Combined with service firewalls, service endpoints can negate the need for public access.

> ### Connectivity and Configuration

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/FDEC4107-ADA4-4CA5-89F5-97016962E5B2_2/nyv9B2gPxeIoGxf5x6YqbRWbTyUKqB6HsQykaOSp2LAz/Image.jpeg)

> ### Important Considerations

- > Private IP Addressing
   - > Service endpoints DO NOT establish a private IP address for the configured service(s).
- > Outbound Addressing
   - > The Private IP address of the source is provided to the service being accessed.
- > Large Surface Area
   - > There is no granular control over which individual services can be accessed once a service endpoint is configured.

## Private Link

- > Private Addressing
   - > Access services over the Microsoft backbone using a private IP address.
- > Granular Security
   - > More Granular control over available resources compared to service endpoints.
- > Extended accessibility
   - > Connect to customer or partner-owned services globally and from on-premises.

### VNet Peering

- > Allows you to establish connectivity between Virtual Networks.
- > When setting up peering, you need to set the connection up from VNet1 - VNet2 and vice versa.
- > Provides connectivity over private IP.
- > Supports cross-region connectivity
- > Address spaces cannot overlap!
- > Does not support transitive routing.

### VPN

- > VPN Gateway
   - > A VNet Gateway of VPN type. Must exist in a gateway subnet. VPN SKU determines features, bandwidth etc.
- > Local Network Gateway
   - > A resource used to define the on-prem networks that will be available via VPN.
- > VPN Connection
   - > A resource used to establish the VPN connection, including authentication, encryption, and the VPN endpoint.

### Express Route

- > Uses Microsofts backbone to connect On-prem to Cloud services
- > ExpressRoute Circuit
   - > The connectivity into Microsoft global infra, which leverages both Microsoft and partner edge networking.
- > Peering
   - > Private or Microsoft peering facilitates a secure connection to virtual networks or M365, respectively.
- > ExpressRoute Gateway
   - > A VNet Gateway of **ExpressRoute** type. Must exist in a gateway subnet. SKU determines features, bandwidth, etc.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/A7FEBDC3-63A0-43B7-B994-331685858EAF_2/Yeb8ZwfB10t88UVmTvMYKduLTZgGjOkPqk88dl8saosz/Image.jpeg)

### Service Firewalls

- > Enabling a service firewall creates a default DENY ALL rule for the public endpoint of a resource. All traffic will be blocked unless allowed.
- > Firewall rules for services can include allowed public IP addresses of users/ services you wish to permit.
- > To allow traffic from a virtual network, a service endpoint must be enabled and the respective subnet added.

### Application Gateway

- > Often referred to as an application-aware (layer 7) load balancer
- > Public Load Balancing
   - > Provides public access
- > URL based routing
   - > Route traffic to different backend pools, depending on the URL path requested.
- > Session Affinity
   - > Gateway-Managed, cookie-based session affinity that keeps user sessions on the same server.
- > Autoscaling
   - > Scale the application gateway up or down, based on the demands of your user / services.
- > Web Security
   - > Web protection features like the WAF and HTTP header rewrite.
- > SSL Termination
   - > Terminate SSL / TLS at the gateway, removing the encryption / decryption overhead from backend servers.

![Screenshot 2023-10-04 at 20.13.34.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/1ED71BE6-432D-494D-BBCC-F76A62F89D08_2/yMRxmdxqdsqXdSHPcST6DYzyAsMuoXt0yfO9ynBNqqYz/Screenshot%202023-10-04%20at%2020.13.34.jpeg)

### Configuration Overview

- > Frontend IP
   - > The IP address associated with the AG
- > Listener
   - > IP address, port, protocol, and (if HTTPS is enabled) the associated SSL Cert that is used by the AG.
- > Rule (and Settings)
   - > The rule brings everything together, including HTTP settings (port, persistence, path-based routing, timeout period etc).

### Azure Front Door

- > Web App acceleration and delivery at a Global Scale!
- > Leverages Microsoft's global edge network
- > Designed for web apps
- > Supports Azure services, and on-prem (hybrid)
- > Supports acceleration, caching, security, and more.

   > *Azure Front Door is a content acceleration solution that leverages Microsoft's global edge network provide fast connectivity to your solution across the globe*.

### Configuration

- > Frontend
   - > Frontend host / domain (can be custom) where traffic will be directed to your global solution.
- > Backend
   - > Backend pool to service the solution, and supports integration with many Azure services, or custom / on-prem also.
- > Routing
   - > Connects the frontend and backend. Additional features can be configured, including caching, and URL path matching.

### Web Application Firewalls

- > Protect against common threats and exploits. e.g Sql Injection and Cross-site scripting

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/72FC2536-770D-44FF-AFE7-AC14B5FEA33D_2/NemLivrAWWs8ALNY6VHy2pw6rY7vQPgTBj5jecOr2lgz/Image.jpeg)

> # Securing Virtual Machines

## Azure Bastion

- > Can help with the administration of Windows and Linux virtual machines.
- > HTML5 Web Client over port 443
- > SSL link over the internet
- > Microsoft hardens the Azure Bastion service for you
- > Must be deployed to a subnet called "AzureBastionSubnet"
- > To access (connect) to the VMs the admin will need "Read Access" to;
   - > Bastion Service
   - > VM it is associated with
   - > NIC of the VM
   - > Virtual Network

## Just-In-Time VM Access

- > Once set up it automatically configures an RDP inbound DENY rule on the NSG (4096 DENY)

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/669E5C9C-8A99-4D06-B2A6-BF5D389D3DBB_2/ux5gtjDn9GryxXQRsVmOEdXECS6EgY58ZHoArB9w7PAz/Image.jpeg)

- > Defender for Cloud needs to be Enabled for JIT
- > After requesting access to JIT, the NSG is updated with an ALLOW rule to allow access from a specific IP address for a specific amount of time.

## VM Endpoint Protection

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/53CE3398-7C62-4349-AC44-9A1675B47164_2/hSuCdeP8mKExFEm8kOuYx3H8Xc3SVZjnlGudiObKchoz/Image.jpeg)

## Azure Disk Encryption

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/14F95179-581D-4603-AC64-EC3997D4D0A1_2/E28lnRZ2l9o07MPpUFMf02BDL1V1mpu9tx5hvngVLa0z/Image.jpeg)

- > Azure VM disks are encrypted at rest by default. The goal of Azure Disk Encryption is to protect the actual volumes stored within the VM disks themselves.

> #### Volume Encryption

- > Encrypts boot (OS) and data volumes ti further protect your data.

> #### Windows and Linux

- > Supports both Windows and Linux VMs.

> #### Extended Encryption

- > Azure Disk Encryption can be enabled in conjunction with SSE.

> ### Implementation

> #### Virtual Machine

- > ADE can be enabled for a VM (standalone, or within a VM scale set)

> #### Virtual Machine Extension

- > A VM extension configures operating system encryption. Linux uses dm-crypt, and Windows uses BitLocker.

> #### Key Vault

- > The keys/secrets used as part of the encryption and decryption of data are stored within Azure Key Vault.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/BF1710B3-C58F-44B6-ADD4-68F636ECFF75_2/5mSMypnzNSt6g1oAvcXJl50fszCnQBiAj8o1xOUPsKoz/Image.jpeg)

> #### Key Points

- > VM Support
   - > Does not support Basic, A-series VMs, or VMs that do not meet memory requirements.
   - > Windows requires at least 2GB memory.
- > Disk Type Support
   - > Does not currently support Ephemeral OS Disks.

## Managing VM Updates

> ### Azure Update Management

> #### Patch Management

- > Patch Management, scheduling and reporting.

> #### Windows and Linux

- > Supports both Windows and Linux VMs.

> #### Hybrid Support

- > Can manage updates for machines inside and outside of Azure.

> ### AUM - Components

> #### Automation Account

- > Service to facilitate the process automation and config management

> #### Hybrid Runbook Worker

- > Customer-managed WIndows or Linux operating system which performs tasks.

> #### Log Analytics Workspace

- > Repository for log information. In this scenario, it is for updating management data.

> #### Log Analytics Agent

- > The software which routes logs/metric data from Linux or Windows to the workspace.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/1EB9E5B8-415B-4EBE-A6FF-7E6A6A907C51_2/E76g3SvpMTEB2CUAfKz0ta9nSYOuuC9h1GtSw9FQ5QUz/Image.jpeg)

> # Securing Applications with Azure AD

## Service Principles

- > Service Principal acts as the Web App within Azure AD, just like a User account represents a real person.
- > We use Service Principles to provide an identity for an application within Azure AD.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/954017D9-F49E-43B6-BAD3-D78A16A7D4B0_2/SRWXxjFOVIh1UjWwj0O4nskmgX0UKMKQjSR7oxNv0XUz/Image.jpeg)

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/693044ED-4C06-49D1-BD68-3E4DB24DC488_2/ePX9mfkXayFlCgsSS2AuPOYdatYWVbgbkyM7maQhKsUz/Image.jpeg)

## Managed Identities

- > Leverage the Azure platform to **perform authentication** without the need of client secrets of certificates.
- > Microsoft manage the platform authentication so you don't have to store your client secrets in code.
- > Possible types of managed identities;
   - > User-assigned
   - > System assigned
- > An application accessing a resource on behalf of a user uses 'Delegated Permissions'.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/DCA77553-9581-440A-BF0F-88EFC248E97C_2/5tVGFdz1KCWw4rU3i5pRUkopIshcqLjN2W5D0KiFSOEz/Image.jpeg)

> ### Key Components

> #### Managed Identity

- > An Azure resource must be assigned a system or user-managed identity.

> #### Azure AD Service Principal

- > The managed identity establishes a service principal within Azure.

> #### Token Endpoint

- > Azure AD provides this as a place to retrieve an access pass for a resource.

> #### Access Token

- > The access token can be used to authenticate with Azure AD.

## API Access to Microsoft

> #### Microsoft Graph

- > A gateway to volumes of information stored across Microsoft 365 services. This includes data from M365, Win 10, and Enterprise Mobility + Security.
- > Azure AD roles that can provide tenant-wide consent for delegated permissions to Microsoft Graph;
   - > Privileged Role Admin
   - > Application Admin
   - > Global Admin
   - > Cloud App Admin

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/267937EA-E6D7-459C-A587-D805E10516E9_2/8ESmQoFCPlZAJEHoblZxKh3UWI2po9aUGfZy3UjJ33gz/Image.jpeg)

- > In accordance with the OAuth 2.0 standard, access to a resource can be controlled granularly through the use of resource permissions (also known as scopes).

#### OAuth 2.0 Authentication Flow

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/C672673B-89F7-4E88-868C-93F1A8838067_2/p3T4PBVaOCqoramX8KfM26Xs4QvvlOozxxL2fZfSnQoz/Image.jpeg)

> ## Securing Data with Key Vault

> #### Securing Application Data

- > Key Vault is an important Azure service that helps to secure data used for applications, automation, and administration.

#### Key Vault Overview

![Screenshot 2024-01-11 at 10.26.30.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/071A9E5C-D558-4C39-81D1-703AF50D15AF_2/QUbZOQBPMAhxZcKEv4JmI3jMrExNyHp5jhinuscXuvwz/Screenshot%202024-01-11%20at%2010.26.30.png)

#### Important Components

> Key Vault

- > Secure storage (software protection or hardware security modues (HSM)) accessible by a REST API.

> Secret Information

- > Support for **secrets, keys** and **certificates.** This also includes some additional management capabilities.

> Access Control

- > Access to the Key Vault 🔑 data plane can be controlled through either access policies or RBAC.
- > Even if you are the owner of the subscription doesn't mean you will necessarily have access to the data plane of the Key Vault 🔑 .
- > 2 tyoes of 'Access Policy'
   - > Vault Access Policy (traditional)
   - > Azure RBAC

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/F11F4440-3293-4C11-AE02-0C064BE64EF5_2/delPpUBuofJQvYrJ3HkBQC2GyRzI4GHiHVUAKgbBpBwz/Image.png)

#### Azure CLI command to add secret to Key Vault

- > `az keyvault secret set --vault-name "capseccokv1" --name "AdminPassword" --value "Password123"`
- > Vault name = Whatever you called your specific Key Vault
- > Name = What you want to call the secret
- > Value = Your choice of password (if the secret you're creating is a password for instance)
- > git clone (link to git file you want to run)
- > pip install azure.identity
- > pip install azure.keyvault.secrets
- > az account list (retrieves tenant ID)
- > code (python file name) opens VSCode within Azure bash

### Key Vault Administration

> #### Managing Objects

- > Keys and certificates can be either generated or imported. Secrets can be created (as a binary object).

> #### Version Control

- > Multiple versions of the objects can exist. This helps for rotation of security objects, minimising downtime.

> #### Lifecycle Control

- > Activation and expiration dates can be configured and versions of objects. They also can be enabled/disabled.

### Key Vault Backup and Recovery

> ### Common Tasks

> #### Soft-Delete

- > Soft-delete provides recycle bin-like functionality so items can be recoveredfor a retention period.

> #### Purge Protection

- > Purge protection ensures soft-deleted items cannot be purged until the retention period has elapsed.

> #### Backup and Recovery

- > Backuo is possible (but not recommended). Recovery is managed bby the platform by default.

> ## Securing Application Hosting

### Azure App Service Security

> General considerations

- > Inbound connections over the internet need to go through a firewall.
- > Connections from within the busines can go through Private links (VNets)

> Configuring SSL / TLS Certificates

- > Custom Domain
   - > An app must be running on an App Service plan that supports custom domains (all except free pricing)
- > Certificate
   - > To facilitate secure HTTPS encryption, a private certificate must be uploaded (password-protected PFX with 3DES)
- > Binding
   - > To enable HTTPS access, a binding must be configured using a domain (SNI SSL) or a public IP address (IP SSL).
   - > HTTPS can be forced.

> #### Creating a Web App

- > When creating a web app, if you choose the free or shared app sevice SKU you will not be able to customise your own domain.
- > You will need to choose the standard SKU to be able to customise your domain.

### Azure Functions Security

> General Considertions

- > Similar to Azure App Services above
- > When creating apps within a Azure Function, they will all share the same environment

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/AADF5355-B698-4D01-81A0-9637FEC91A37_2/DLnGjMMHl4zm2c9xUxk0sPVT9Fyzcv7GzKmSqnp3aoQz/Image.png)

> #### Configuring SSL / TLS

- > **Securing Website Access**
   - > Requires a custom domain, an SSL cert (PFX format, 3DES) and a binding. Consumption plan supported.
- > **Leveraging Certificates eith Code**
   - > To load certificates, you must configure WEBSITE_LOAD_CERTIFICATES = <comma-separated-certificate-thumbprints>.
- > **Enforcing HTTPS**
   - > You can redirecr all HTTP requests to the HTTPS port by configuring *HTTPS Only.*

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/CA94574D-92B5-403F-9092-E20D5F83F145_2/eCmUbq7SRA8ZBuwJlq2WEE2pheO7Y1pXFgWA7bya5Hsz/Image.png)

### Function Access Keys

- > **Host Keys**
   - > Can be used to access any function within the function app. A master key also exists for full admin access.
- > **Function Keys**
   - > Function keys provide access for a given function only. They take precedence over host keys if both are named the same.
- > **Key Rotation**
   - > Keys can be rotated manually by creating multiple keys for app / client use and renewing key values as required.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/D55BB4CF-8C36-49F6-9325-993DDEBD897B_2/cVbLjpFwFiuOXXlyyqJipxmbcXuDKZREo0C98WSQKxsz/Image.png)

### App Service Environments

> #### Dedicated Environment

- > Deployed to a Virtual Network (and dedicated hosts)

> #### Secure Access

- > Access can be configured for either internal or external use

> #### High Scale

- > Leverage greater scale-out limits for hyperscale

> ### Architecture

> #### Hosting

- > Normal deployment uawa multi-tenant hypervisors. Dedicated hosts can be used for futher isolation.

> #### Network

- > An App Service Environment (ASE) is deployed to an ASE subnet within a customers virtual network. Apps can communicate through the VNet.

> #### Accessibility

- > Can be accessed publicy (external ASE) with public DNS, or privately (internal ASE) with private DNS zones.

> #### App Service Plan (ASP)

- > An app is deployed to an ASP, which is deployed to an ASE. These are used as normal (based on OS and resources).

### Azure Container Registry Security

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/54748037-02EC-4594-99F6-CA14A4574C7C_2/rmUryeR82VXzyKT2b33OhJd11oeyXPLaAx99c285thYz/Image.png)

> #### Access Control

- > `Docker push image`
   - > Use this command to share your images to the Docker Hub registry or to a self-hosted one.
- > `Docker pull image`
   - > Use this command to download a Docker image or a repository locally on the host from a public or private registry.

### Content Trust

> #### Registry Level Trust

- > Content trust is enabled at the Azure Container Registry Level. This requires the premium SKU.

> #### Pushing Signed Images

- > Users must be assigned *ACRImgeSigner* permissions (plus AcrPush). The first push of a signed image creates signing keys.

> #### Pulling Signed Images

- > When a consumer enables content trust for their Docker client, only signed images will be available.

### General Security Considerations

> #### ACR Tasks

- > Helps to automate tasks like image builds, OS and framework patching, and more.

> #### Image Scanning

- > Container images should be scanned regularly for vulnerabilities.

> #### Credential Protection

- > We can use services like managed identities and Azure Key Vault to help secure credentials.

### Azure Container Instances Security

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/7FF18FF3-DDA1-42A7-B28E-933013A8B657_2/bA07yAbQWkybook3yOgu8tkAj9E8e5uh8ElFwr81CG0z/Image.png)

### Variables

> #### Purpose of Variables

- > Variables help provide dynamic information to containers (so it doesn't have to be baked into the image).

> #### Environment Variables

- > Environment variables can be configured when a container instance is created. They use key-value pairs.

> #### Secure Values

- > When using Secure as an environment variable type, this data is only accessible from within the container.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/0F826413-81F6-4925-A087-8D3ADAED3F5E_2/dp55P2pEg4WZYjrkiKUoJv3JdBEe7OvlNoI8wC3Wo3oz/Image.png)

### Container Groups

> #### Purpose

- > When building an application sidecar for things like logging, monitoring, or when a second attached process is needed.

> #### Hosting

- > Container group containers are scheduled on the same host machine and share a lifecycle, resources, network and storage.

> #### Configuration

- > Can be deployed via ARM or YAML, but the latter can only support Linux. Can sit behind a Public IP with optional exposed ports.

### Azure Kurbernetes Service Security (AKS)

> #### Master Security

- > Microsoft manages master components. You should keep the version up to date when possible and use private clusters if needed.

> #### Node Security

- > Nodes are Azure VMs that customers manage / maintain. Linux patching is scheduled nightly. Windows patching must be configured.

> #### Kubernetes Secrets

- > Prevents secret information from being stored in the YAML manifest. Instead, the data is provided through the Kubernetes API to a pod.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/0A17848C-2B2A-4985-8599-FB4EE7ED08B5_2/7XD82IFptvxQ00kC0cQHMsc68tpPG60YUppPAEkODikz/Image.png)

### Legacy Azure AD integration

> #### AKS Cluster Identites

- > Identites are used to create resources and interact with others (e.g, ACR)

> #### Kubernetes RBAC

- > Granular access control for the Kubernetes cluster. Can be intgrated with Azure AD.

> #### Azure AD Apps (Groups and Auth)

- > An app for reading group membership
- > An app for performing authentication

> #### RBAC Binding

- > Used for Azure AD integration to facilitate the authentication of a user with Azure AD.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/74A1AE40-4F8E-48D2-AF96-709C6AE49807_2/o78dDVrH5iTqXCnR4yeNFaJn4J03RSNuIYEhi1gElmEz/Image.png)

### AKS-Managed Azure AD Integration

> #### AKS Cluster Identites

- > Identites are used to create resources and interact with others (e.g, ACR)

> #### Kubernetes RBAC

- > Granular access control for the Kubernetes cluster. Can be intgrated with Azure AD.

> #### AKS-Managed Azure AD

- > The resource provider manages all required apps for Azure AD integration.

> #### Cluster Admin Group

- > Registered as an admin group on the cluster to grant cluster admin permissions.

![Screenshot 2024-01-16 at 15.59.48.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/53E9E5DA-2E56-4B87-8088-A1A98A82CC9B_2/tWxK5AExBJsykkiAkgbDnjQP64XXsLy2WGTBI6CGrEMz/Screenshot%202024-01-16%20at%2015.59.48.png)

> ## Securing Storage

### Storage Account Access Control

- > Secure connectivity through:
   - > Service Endpoints
   - > Private Link

> #### Access Keys

- > 2 access keys created upon creation of a storage account
- > Access keys provide full access to all services within a storage account
- > When you create a SAS, you do so using an access key (unless using Azure AD)
- > Access keys can be regenerated, revoking all access granted by the key (including any associated SAS).

> #### Shared Access Signatures

- > Service SAS
   - > Provides access to resources within a single service (e.g Blob or Files)
- > Account SAS
   - > Provide access to resources in one or more services within a storage account.
- > Stored Access Policies
   - > Provide greater control over a service SAS, which is otherwise very difficult to control once it has been created.
- > Cannot edit permissions once a SAS is created.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/44C015F7-8134-49A6-951B-46B97699E3E3_2/XcKcZRKIwR39GXCJ5blDYEaSMNOWTgnLXUdtkGZcp4Yz/Image.png)

> ## Azure Storage with Azure AD Authentication

- > RBAC
   - > Can be used to control access to both the management and data layer.
- > User delegation SAS
   - > Just like a normal SAS. However, instead of being created with storage account access key, it is associated with an Azure AD Identity.

> ### Azure Files with Azure AD DS Authentication

- > Fully managed File-Level Sharing
   - > Provides traditional on-premises-like file sharing functionality with a true folder hierarchy.
- > Designed for SMB Connectivity
   - > Provided connectivity over the SMB protocol. End users or applications access files over a network connection.
- > Extended by Azure File Sync
   - > Supports synchronisation between multiple Windows Server file servers and the Azure Files Service.
- > For SMB access to Azure File Shares, **Azure AD identities** can be used for authentication and authorisation. This type of access control is for SMB access from domain-joined devices.

![Image.jpeg](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/75240AC0-C3CE-49D0-A54C-18B3AECCDAB3_2/xqkCA8nLk1jZEsskmIdFrvu5kEGGIbxRm0xU1KiyHBEz/Image.jpeg)

> # Securing Data

### Azure SQL Authentication

> High level look at how access can be controlled for Azure SQL:

- > SQL Login resides in masterDB
- > Database user within each database you want that user to have access too
- > Map both of the above together which will allow the user to authenticate using their Sql server login

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/DBCA3C1F-6662-46DD-B51E-BB8360AB7E3A_2/7zQDXCIvTDy46KqA46c5fsAkycgzxxaAdHh9Xitx2TIz/Image.png)

### Authentication with Azure AD Identities

> To authenticate with Azure AD Identities, we need to associate them with SQL logins or database users.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/C9B68A8B-2542-48CF-88D7-A21F28D2FA86_2/bnJxbSuxyyOnospcolB896pwa1vc3JloarLjxqXtaxYz/Image.png)

> If we're working with the Azure SQL database service, we don't need to create a SQL login.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/5CAF3FB7-0842-4127-BA75-BEC0397066FB_2/7QgedqBdEx1J9pcQWxCLPPDCxjxQGUpWX6VhBNzDABcz/Image.png)

### SQL Logins

> #### SQL Login Creation

- > SQL Login
- > Windows Logins (SQL VM Only)
- > Azure AD logins (unsupported by Azure SQL DB)

> #### Azure AD Admin for SQL

- > And Azure AD admin must be configured to enable Azure AD authentication. The admin can be either an Azure AD user or group.

> #### Read Permissions

- > For managed instances, be aware that a Global Admin must also configure read permissions to your Azure AD tenant.

### Azure SQL Database Encryption

> ### Always Encrypted Implementation

- > Column Encryption Types
   - > Randomized - Less predictable encryption
   - > Deterministic - Generates the same encrypted value for a given text value (but supports point lookups, equality joins, grouping and indexing)
- > Key Storage Options
   - > The database engine does not store encryption keys. These must be stored elsewhere e.g Key Vault, or Windows Certificate Store.
- > Application Client
   - > To access encrypted column data in plaintext, an application must use an Always Encrypted-enabled client driver with access to the key storage.

![Image.png](https://res.craft.do/user/full/f14daadb-9175-da55-3d5f-ffa67ffaaf79/doc/1E63ABDA-E927-44F0-926A-FE0EC150D055/244ED572-45B4-47C1-8CD7-222D6ED1E72C_2/G5xAjzh4Abzl8ytxC8OSuJXmMMuc2NesDgdyeDXRQmoz/Image.png)

